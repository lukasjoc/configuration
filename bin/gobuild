#!/bin/bash

print_validate_err() {
  echo "Error: golang is not installed or GOPATH is not set or added to PATH"
  echo "What is the GOPATH? => https://github.com/golang/go/wiki/GOPATH"
  echo "How to set GOPATH? => https://github.com/golang/go/wiki/SettingGOPATH"
  exit 1
}

if [ ! command -v go >/dev/null 2>&1 ] || [ -z "$GOPATH" ]; then
  print_validate_err
fi

if ! echo "$PATH" | grep -q "$GOPATH"; then
  print_validate_err
fi

# check for too less or to much args and exit appropriately
if [[ $# -le 1 || $# -gt 2 || $1 == "--help" ]]; then
  printf '%s\n\n' "Build go app for GOOS(darwin,linux) GOARCH(amd64)"
  printf '%s\n' "Usage:"
  printf '%s\n\n'  "  ./go_build.sh arg1: system(darwin/mac, linux), arg2:binary_name(some_name)"
  printf '%s\n' "Flags:"
  printf '%s\n\n' "   --help help for this bash script"
  exit 1
fi

if [ $1 == "linux" ]; then
  echo "Building $2 for $1 amd64"
  GOOS=linux GOARCH=amd64 go build -ldflags="-s -w" -o $2
  exit 0
fi

echo "Building $2 for $1 amd64"
GOOS=darwin GOARCH=amd64 go build -ldflags="-s -w" -o $2
exit 0

